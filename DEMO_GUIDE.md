# 🧪 デモ環境ガイド

MoneyTicket SMS認証システムのデモ環境へようこそ！このガイドでは、セキュリティレベルを保ったまま、システムを安全に体験する方法をご説明します。

## 📋 目次

- [デモ環境の特徴](#デモ環境の特徴)
- [利用方法](#利用方法)
- [デモ用電話番号](#デモ用電話番号)
- [セキュリティ仕様](#セキュリティ仕様)
- [制限事項](#制限事項)
- [技術仕様](#技術仕様)

## 🌟 デモ環境の特徴

### ✅ **実際のSMS送信なし**
- SMS料金が発生しません
- 即座に認証コードを確認できます
- 携帯電話番号を持たない方でも体験可能

### 🔒 **本番同等のセキュリティ**
- レート制限機能
- 失敗回数制限
- セッション管理
- IPアドレス制限
- データ暗号化

### 🛡️ **完全データ分離**
- 本番環境とは完全に分離
- デモデータは自動削除
- 個人情報の保護

## 🚀 利用方法

### 1. デモアクセスの開始

1. SMS認証画面で**「デモ環境を試す」**ボタンをクリック
2. デモアクセス確認ダイアログで**「デモ環境にアクセス」**をクリック
3. デモトークンが自動生成され、デモ環境が開始されます

### 2. デモ認証の実行

1. **デモ用電話番号を入力**（下記リストから選択）
2. **「デモ認証コードを取得」**をクリック
3. 認証コード **`123456`** を入力
4. **「デモ認証を完了」**をクリック

### 3. 結果の確認

デモ認証完了後、デモ用の診断結果ページが表示されます。

## 📱 デモ用電話番号

以下のデモ用電話番号のいずれかをご使用ください：

```
090-0000-0001
090-0000-0002
090-0000-0003
090-0000-0004
090-0000-0005
090-0000-0006
090-0000-0007
090-0000-0008
090-0000-0009
090-0000-0010
```

### 📝 使用方法
- ハイフンありなしどちらでも入力可能
- 上記以外の番号は使用できません
- 認証コードは常に **`123456`** です

## 🔐 セキュリティ仕様

### アクセス制御
- **セッション時間**: 30分間
- **同時セッション数**: IP毎に最大3セッション
- **トークン長**: 64文字のランダム文字列

### レート制限
- **SMS送信**: 1分間に3回まで
- **認証試行**: 最大5回まで
- **IP制限**: 1時間に10回まで

### データ保護
- 全ての通信は暗号化
- セッションデータは自動削除
- アクセスログは30日間保持

## ⚠️ 制限事項

### 機能制限
- 実際のSMS送信は行われません
- デモ用電話番号のみ使用可能
- 本番データとは分離されています

### 時間制限
- デモセッションは30分間で自動終了
- 期限切れ後は新しいアクセスが必要

### 接続制限
- 同時接続数に上限があります
- 集中アクセス時は待機が必要な場合があります

## 🔧 技術仕様

### アーキテクチャ

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   フロントエンド   │    │   デモAPI        │    │  デモDB          │
│                 │    │                 │    │                 │
│ - DemoNotice    │◄──►│ - demo-send-otp │◄──►│ - demo_sessions │
│ - DemoPhoneAuth │    │ - demo-verify   │    │ - demo_sms_*    │
│                 │    │                 │    │ - demo_logs     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### API エンドポイント

#### デモアクセス要求
```http
POST /api/demo-send-otp
Content-Type: application/json

{
  "requestDemoAccess": true
}
```

#### デモSMS送信
```http
POST /api/demo-send-otp
Content-Type: application/json

{
  "phoneNumber": "09000000001",
  "demoToken": "abc123..."
}
```

#### デモOTP検証
```http
POST /api/demo-verify-otp
Content-Type: application/json

{
  "phoneNumber": "09000000001",
  "code": "123456",
  "demoToken": "abc123..."
}
```

### データベーステーブル

#### demo_sessions
```sql
CREATE TABLE demo_sessions (
    id UUID PRIMARY KEY,
    demo_token VARCHAR(64) UNIQUE,
    client_ip INET,
    expires_at TIMESTAMP,
    is_active BOOLEAN,
    created_at TIMESTAMP
);
```

#### demo_sms_verifications
```sql
CREATE TABLE demo_sms_verifications (
    id UUID PRIMARY KEY,
    phone_number VARCHAR(20),
    otp_code VARCHAR(6),
    demo_token VARCHAR(64),
    is_verified BOOLEAN,
    expires_at TIMESTAMP
);
```

## 📊 監視とログ

### アクセス監視
- 全てのデモアクセスはログ記録
- 異常なアクセスパターンを検出
- リアルタイム統計情報を提供

### 自動クリーンアップ
- 期限切れセッションの自動削除
- 古いログデータの定期削除
- システムリソースの最適化

## 🆘 トラブルシューティング

### よくある問題

**Q: デモアクセスが取得できません**
A: 同時アクセス数が上限に達している可能性があります。しばらく待ってから再試行してください。

**Q: 認証コードが正しくありません**
A: デモ用認証コードは常に `123456` です。正確に入力してください。

**Q: セッションが期限切れになりました**
A: デモセッションは30分間で自動終了します。新しいデモアクセスを要求してください。

**Q: デモ用電話番号が使用できません**
A: `090-0000-0001` から `090-0000-0010` の範囲内の番号のみ使用可能です。

### エラーコード

| コード | 説明 | 対処方法 |
|--------|------|----------|
| 400 | 不正なリクエスト | 入力データを確認してください |
| 403 | アクセス拒否 | デモトークンを再取得してください |
| 429 | レート制限 | しばらく待ってから再試行してください |
| 500 | サーバーエラー | 管理者にお問い合わせください |

## 🔄 開発者向け情報

### 設定ファイル
- `src/config/demoConfig.ts` - デモ環境設定
- `src/utils/demoUtils.ts` - デモ用ユーティリティ

### 環境変数
デモ環境では以下の環境変数を使用します：

```env
SUPABASE_URL=your_supabase_url
SUPABASE_SERVICE_ROLE_KEY=your_service_key
```

### カスタマイズ
デモ環境の設定は `src/config/demoConfig.ts` で変更できます：

```typescript
export const DEMO_CONFIG = {
  phoneNumbers: [...], // デモ用電話番号
  otpCode: '123456',   // 固定OTPコード
  session: {
    timeout: 30 * 60 * 1000, // セッション時間
  },
  // その他の設定...
};
```

## 📞 サポート

デモ環境に関するご質問やサポートが必要な場合は、以下までお問い合わせください：

- **Email**: support@moneyticket.com
- **GitHub Issues**: [プロジェクトのIssuesページ](https://github.com/your-repo/issues)
- **Documentation**: [完全なドキュメント](https://docs.moneyticket.com)

---

**タスカル デモ環境** - セキュアで安全なSMS認証システムの体験版

*最終更新: 2024年12月19日*